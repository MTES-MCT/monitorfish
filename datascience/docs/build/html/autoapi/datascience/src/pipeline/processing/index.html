

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>datascience.src.pipeline.processing &mdash; Monitorfish  documentation</title>
  

  
  <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../../_static/graphviz.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../../" src="../../../../../_static/documentation_options.js"></script>
        <script data-url_root="../../../../../" id="documentation_options" src="../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../_static/jquery.js"></script>
        <script src="../../../../../_static/underscore.js"></script>
        <script src="../../../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" />
    <link rel="next" title="datascience.src.pipeline.schedules" href="../schedules/index.html" />
    <link rel="prev" title="datascience.src.pipeline.generic_tasks" href="../generic_tasks/index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../../index.html" class="icon icon-home"> Monitorfish
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../data-sources.html">External data sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../flows.html">Flows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../containerization.html">Containerization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../deployment.html">Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../reference.html">API reference</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">Monitorfish</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../../../../reference.html">API reference</a> &raquo;</li>
        
          <li><a href="../index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">datascience.src.pipeline</span></code></a> &raquo;</li>
        
      <li><code class="xref py py-mod docutils literal notranslate"><span class="pre">datascience.src.pipeline.processing</span></code></li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../../../../_sources/autoapi/datascience/src/pipeline/processing/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-datascience.src.pipeline.processing">
<span id="datascience-src-pipeline-processing"></span><h1><a class="reference internal" href="#module-datascience.src.pipeline.processing" title="datascience.src.pipeline.processing"><code class="xref py py-mod docutils literal notranslate"><span class="pre">datascience.src.pipeline.processing</span></code></a><a class="headerlink" href="#module-datascience.src.pipeline.processing" title="Permalink to this headline">¶</a></h1>
<div class="section" id="module-contents">
<h2>Module Contents<a class="headerlink" href="#module-contents" title="Permalink to this headline">¶</a></h2>
<div class="section" id="functions">
<h3>Functions<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h3>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#datascience.src.pipeline.processing.is_a_value" title="datascience.src.pipeline.processing.is_a_value"><code class="xref py py-obj docutils literal notranslate"><span class="pre">is_a_value</span></code></a>(x) → bool</p></td>
<td><p>Returns False if pd.isna(x), True otherwise.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#datascience.src.pipeline.processing.concatenate_values" title="datascience.src.pipeline.processing.concatenate_values"><code class="xref py py-obj docutils literal notranslate"><span class="pre">concatenate_values</span></code></a>(row: pandas.Series) → List</p></td>
<td><p>Filters the input pandas Series to keep only distinct non null values</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#datascience.src.pipeline.processing.concatenate_columns" title="datascience.src.pipeline.processing.concatenate_columns"><code class="xref py py-obj docutils literal notranslate"><span class="pre">concatenate_columns</span></code></a>(df: pandas.DataFrame, input_col_names: List) → pandas.Series</p></td>
<td><p>For each row in the input DataFrame, the distinct and non null values contained in</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#datascience.src.pipeline.processing.combine_overlapping_columns" title="datascience.src.pipeline.processing.combine_overlapping_columns"><code class="xref py py-obj docutils literal notranslate"><span class="pre">combine_overlapping_columns</span></code></a>(df: pandas.DataFrame, ordered_cols_list: List) → pandas.Series</p></td>
<td><p>Combines several columns into one by taking the first_valid_value in each row,</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#datascience.src.pipeline.processing.get_first_non_null_column_name" title="datascience.src.pipeline.processing.get_first_non_null_column_name"><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_first_non_null_column_name</span></code></a>(df: pandas.DataFrame, result_labels: Union[None, dict] = None) → pandas.Series</p></td>
<td><p>Returns a Series with the same index as the input DataFrame, whose values are</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#datascience.src.pipeline.processing.df_to_dict_series" title="datascience.src.pipeline.processing.df_to_dict_series"><code class="xref py py-obj docutils literal notranslate"><span class="pre">df_to_dict_series</span></code></a>(df: pandas.DataFrame, result_colname: str = 'json_col')</p></td>
<td><p>Converts a pandas DataFrame into a Series with the same index as the input</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#datascience.src.pipeline.processing.zeros_ones_to_bools" title="datascience.src.pipeline.processing.zeros_ones_to_bools"><code class="xref py py-obj docutils literal notranslate"><span class="pre">zeros_ones_to_bools</span></code></a>(df: pandas.DataFrame) → pandas.DataFrame</p></td>
<td><p>Converts a pandas DataFrame containing “0”, “1” and None values</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#datascience.src.pipeline.processing.to_pgarr" title="datascience.src.pipeline.processing.to_pgarr"><code class="xref py py-obj docutils literal notranslate"><span class="pre">to_pgarr</span></code></a>(x: Union[list, set, numpy.ndarray], handle_errors: bool = False, value_on_error: Union[str, None] = None) → Union[str, None]</p></td>
<td><p>Converts a python <cite>list</cite>, <cite>set</cite> or <cite>numpy.ndarray</cite> to a string with Postgresql</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#datascience.src.pipeline.processing.df_values_to_psql_arrays" title="datascience.src.pipeline.processing.df_values_to_psql_arrays"><code class="xref py py-obj docutils literal notranslate"><span class="pre">df_values_to_psql_arrays</span></code></a>(df: pandas.DataFrame, handle_errors: bool = False, value_on_error: Union[str, None] = None) → pandas.DataFrame</p></td>
<td><p>Returns a <cite>pandas.DataFrame</cite> with all values serialized as strings</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#datascience.src.pipeline.processing.json_converter" title="datascience.src.pipeline.processing.json_converter"><code class="xref py py-obj docutils literal notranslate"><span class="pre">json_converter</span></code></a>(x)</p></td>
<td><p>Converter for types not natively handled by json.dumps</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#datascience.src.pipeline.processing.to_json" title="datascience.src.pipeline.processing.to_json"><code class="xref py py-obj docutils literal notranslate"><span class="pre">to_json</span></code></a>(x: Any) → str</p></td>
<td><p>Converts python object to json string.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#datascience.src.pipeline.processing.df_values_to_json" title="datascience.src.pipeline.processing.df_values_to_json"><code class="xref py py-obj docutils literal notranslate"><span class="pre">df_values_to_json</span></code></a>(df: pandas.DataFrame) → pandas.DataFrame</p></td>
<td><p>Returns a <cite>pandas.DataFrame</cite> with all values serialized to json string.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#datascience.src.pipeline.processing.drop_rows_already_in_table" title="datascience.src.pipeline.processing.drop_rows_already_in_table"><code class="xref py py-obj docutils literal notranslate"><span class="pre">drop_rows_already_in_table</span></code></a>(df: pandas.DataFrame, df_column_name: str, table: sqlalchemy.Table, table_column_name: str, connection: sqlalchemy.engine.base.Connection, logger: logging.Logger) → pandas.DataFrame</p></td>
<td><p>Removes rows from the input DataFrame <cite>df</cite> in which the column <cite>df_column_name</cite></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#datascience.src.pipeline.processing.prepare_df_for_loading" title="datascience.src.pipeline.processing.prepare_df_for_loading"><code class="xref py py-obj docutils literal notranslate"><span class="pre">prepare_df_for_loading</span></code></a>(df: pandas.DataFrame, logger: logging.Logger, pg_array_columns: Union[None, list] = None, handle_array_conversion_errors: bool = True, value_on_array_conversion_error='{}', jsonb_columns: Union[None, list] = None)</p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#datascience.src.pipeline.processing.join_on_multiple_keys" title="datascience.src.pipeline.processing.join_on_multiple_keys"><code class="xref py py-obj docutils literal notranslate"><span class="pre">join_on_multiple_keys</span></code></a>(left: pandas.DataFrame, right: pandas.DataFrame, on: list, how: str = 'inner')</p></td>
<td><p>Join two pandas DataFrames, attempting to match rows on several keys by</p></td>
</tr>
</tbody>
</table>
<dl class="py function">
<dt class="sig sig-object py" id="datascience.src.pipeline.processing.is_a_value">
<span class="sig-prename descclassname"><span class="pre">datascience.src.pipeline.processing.</span></span><span class="sig-name descname"><span class="pre">is_a_value</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">bool</span><a class="reference internal" href="../../../../../_modules/datascience/src/pipeline/processing.html#is_a_value"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#datascience.src.pipeline.processing.is_a_value" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns False if pd.isna(x), True otherwise.</p>
<p>NB : The same result could be obtained simply by checking pd.isna(x),
but checking if x is None before checking pd.isna(x)
improves performance on DataFrames containing many None values,
since checking pd.isna(x) is slower than checking if x is None.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>x</strong> – Anything</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>False if pd.isna(x), True otherwise</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="datascience.src.pipeline.processing.concatenate_values">
<span class="sig-prename descclassname"><span class="pre">datascience.src.pipeline.processing.</span></span><span class="sig-name descname"><span class="pre">concatenate_values</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">row</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">pandas.Series</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">List</span><a class="reference internal" href="../../../../../_modules/datascience/src/pipeline/processing.html#concatenate_values"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#datascience.src.pipeline.processing.concatenate_values" title="Permalink to this definition">¶</a></dt>
<dd><p>Filters the input pandas Series to keep only distinct non null values
and returns the result as a python list.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>row</strong> (<em>pd.Series</em>) – pandas Series</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>list of distinct non null values in row</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>List</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="datascience.src.pipeline.processing.concatenate_columns">
<span class="sig-prename descclassname"><span class="pre">datascience.src.pipeline.processing.</span></span><span class="sig-name descname"><span class="pre">concatenate_columns</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">pandas.DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">input_col_names</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">List</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">pandas.Series</span><a class="reference internal" href="../../../../../_modules/datascience/src/pipeline/processing.html#concatenate_columns"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#datascience.src.pipeline.processing.concatenate_columns" title="Permalink to this definition">¶</a></dt>
<dd><p>For each row in the input DataFrame, the distinct and non null values contained in
the columns input_col_names are stored in a list. A pandas Series of the same length
as the input DataFrame is then constructed with these lists as values.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>df</strong> (<em>pd.DataFrame</em>) – input DataFrame</p></li>
<li><p><strong>input_col_names</strong> (<em>List</em>) – the names of the columns to use</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>resulting Series</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>pd.Series</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="datascience.src.pipeline.processing.combine_overlapping_columns">
<span class="sig-prename descclassname"><span class="pre">datascience.src.pipeline.processing.</span></span><span class="sig-name descname"><span class="pre">combine_overlapping_columns</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">pandas.DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ordered_cols_list</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">List</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">pandas.Series</span><a class="reference internal" href="../../../../../_modules/datascience/src/pipeline/processing.html#combine_overlapping_columns"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#datascience.src.pipeline.processing.combine_overlapping_columns" title="Permalink to this definition">¶</a></dt>
<dd><p>Combines several columns into one by taking the first_valid_value in each row,
in the order of the ordered_cols_list.</p>
<p>Returns a pandas Series with the combined results.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>df</strong> (<em>pd.DataFrame</em>) – input pandas DataFrame</p></li>
<li><p><strong>ordered_cols_list</strong> (<em>List</em>) – list of column names</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><dl class="simple">
<dt>Series containing the first valid value in each row of the DataFrame,</dt><dd><p>taken in the ordered_cols_list columns.</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>pd.Series</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="datascience.src.pipeline.processing.get_first_non_null_column_name">
<span class="sig-prename descclassname"><span class="pre">datascience.src.pipeline.processing.</span></span><span class="sig-name descname"><span class="pre">get_first_non_null_column_name</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">pandas.DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">result_labels</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">None</span><span class="p"><span class="pre">,</span> </span><span class="pre">dict</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">pandas.Series</span><a class="reference internal" href="../../../../../_modules/datascience/src/pipeline/processing.html#get_first_non_null_column_name"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#datascience.src.pipeline.processing.get_first_non_null_column_name" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a Series with the same index as the input DataFrame, whose values are
the name of the first column (or the corresponding label, if provided) with a
non-null value in each row, from left to right.</p>
<p>Rows with all null values return None.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>df</strong> (<em>pd.DataFrame</em>) – input pandas DataFrame</p></li>
<li><p><strong>result_labels</strong> (<em>dict</em>) – if provided, must be a mapping of column names to the</p></li>
<li><p><strong>labels in the result.</strong> (<em>corresponding</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Series containing the name of the first column with a non-null value
in each row of the DataFrame, from left to right</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>pd.Series</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="datascience.src.pipeline.processing.df_to_dict_series">
<span class="sig-prename descclassname"><span class="pre">datascience.src.pipeline.processing.</span></span><span class="sig-name descname"><span class="pre">df_to_dict_series</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">pandas.DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">result_colname</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">'json_col'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../../../_modules/datascience/src/pipeline/processing.html#df_to_dict_series"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#datascience.src.pipeline.processing.df_to_dict_series" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts a pandas DataFrame into a Series with the same index as the input
DataFrame and whose values are dictionnaries like :</p>
<blockquote>
<div><p>{‘column_1’ : value, ‘column_2’: value}</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>df</strong> (<em>pd.DataFrame</em>) – input DataFrame</p></li>
<li><p><strong>result_colname</strong> (<em>Union</em><em>[</em><em>str</em><em>, </em><em>None</em><em>]</em>) – optionnal, name of result Series</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>pandas Series</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>pd.Series</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="datascience.src.pipeline.processing.zeros_ones_to_bools">
<span class="sig-prename descclassname"><span class="pre">datascience.src.pipeline.processing.</span></span><span class="sig-name descname"><span class="pre">zeros_ones_to_bools</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">pandas.DataFrame</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">pandas.DataFrame</span><a class="reference internal" href="../../../../../_modules/datascience/src/pipeline/processing.html#zeros_ones_to_bools"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#datascience.src.pipeline.processing.zeros_ones_to_bools" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts a pandas DataFrame containing “0”, “1” and None values
to a DataFrame with False, True and None values respectively.</p>
<p>Useful to convert boolean data extracted from Oracle databases, since Oracle does
not have a boolean data type and boolean data is often stored as “0”s and “1”s.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="datascience.src.pipeline.processing.to_pgarr">
<span class="sig-prename descclassname"><span class="pre">datascience.src.pipeline.processing.</span></span><span class="sig-name descname"><span class="pre">to_pgarr</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">list</span><span class="p"><span class="pre">,</span> </span><span class="pre">set</span><span class="p"><span class="pre">,</span> </span><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">handle_errors</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value_on_error</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">None</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">None</span><span class="p"><span class="pre">]</span></span><a class="reference internal" href="../../../../../_modules/datascience/src/pipeline/processing.html#to_pgarr"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#datascience.src.pipeline.processing.to_pgarr" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts a python <cite>list</cite>, <cite>set</cite> or <cite>numpy.ndarray</cite> to a string with Postgresql
array syntax.</p>
<p>Elements of the list-like input argument are converted to <cite>string</cite> type, then
stripped of leading and trailing blank spaces, and finally filtered to keep only
non empty strings.</p>
<p>This transformation is required on the elements of a DataFrame’s columns that
contain collections before bulk inserting the DataFrame into Postgresql with
the psql_insert_copy method.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>list</em><em>, </em><em>set</em><em> or </em><em>numpy.ndarray</em>) – iterable to serialize as Postgres array</p></li>
<li><p><strong>handle_errors</strong> (<em>bool</em>) – if <code class="docutils literal notranslate"><span class="pre">True</span></code>, returns <code class="docutils literal notranslate"><span class="pre">value_on_error</span></code> instead of raising
<code class="docutils literal notranslate"><span class="pre">ValueError</span></code> when the input is of an unexpected type</p></li>
<li><p><strong>value_on_error</strong> (<em>str</em><em> or </em><em>None</em>) – value to return on errors, if <code class="docutils literal notranslate"><span class="pre">handle_errors</span></code>
is <code class="docutils literal notranslate"><span class="pre">True</span></code></p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>string with Postgresql Array compatible syntax</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>str</p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><strong>ValueError</strong> – when <code class="docutils literal notranslate"><span class="pre">handle_errors</span></code> is False and <code class="docutils literal notranslate"><span class="pre">x</span></code> is not list-like.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">to_pgarr</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;a &quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">])</span>
<span class="go">&quot;{1,2,&#39;a&#39;,&#39;b&#39;}&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">to_pgarr</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
<span class="go">ValueError</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">to_pgarr</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">handle_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">value_on_error</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="go">&quot;{}&quot;</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">to_pgarr</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">handle_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">value_on_error</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="datascience.src.pipeline.processing.df_values_to_psql_arrays">
<span class="sig-prename descclassname"><span class="pre">datascience.src.pipeline.processing.</span></span><span class="sig-name descname"><span class="pre">df_values_to_psql_arrays</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">pandas.DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">handle_errors</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value_on_error</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">None</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">pandas.DataFrame</span><a class="reference internal" href="../../../../../_modules/datascience/src/pipeline/processing.html#df_values_to_psql_arrays"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#datascience.src.pipeline.processing.df_values_to_psql_arrays" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a <cite>pandas.DataFrame</cite> with all values serialized as strings
with Postgresql array syntax. All values must be of type list, set or numpy array.
Other values raise errors, which may be handled if handle_errors is set to True.</p>
<p>See <cite>to_pgarr</cite> for details on error handling.</p>
<p>This is required before bulk loading a pandas.DataFrame into a Postgresql table
with the psql_insert_copy method.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>df</strong> (<em>pd.DataFrame</em>) – pandas DataFrame</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><dl class="simple">
<dt>pandas DataFrame with the same shape and index, all values</dt><dd><p>serialized as strings with Postgresql array syntax.</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
</dl>
<p>Examples :</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">df_to_psql_arrays</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">]]}))</span>
<span class="go">    a</span>
<span class="go">0   {1,2,3}</span>
<span class="go">1   {a,b}</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="datascience.src.pipeline.processing.json_converter">
<span class="sig-prename descclassname"><span class="pre">datascience.src.pipeline.processing.</span></span><span class="sig-name descname"><span class="pre">json_converter</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../../../_modules/datascience/src/pipeline/processing.html#json_converter"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#datascience.src.pipeline.processing.json_converter" title="Permalink to this definition">¶</a></dt>
<dd><p>Converter for types not natively handled by json.dumps</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="datascience.src.pipeline.processing.to_json">
<span class="sig-prename descclassname"><span class="pre">datascience.src.pipeline.processing.</span></span><span class="sig-name descname"><span class="pre">to_json</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">str</span><a class="reference internal" href="../../../../../_modules/datascience/src/pipeline/processing.html#to_json"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#datascience.src.pipeline.processing.to_json" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts python object to json string.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="datascience.src.pipeline.processing.df_values_to_json">
<span class="sig-prename descclassname"><span class="pre">datascience.src.pipeline.processing.</span></span><span class="sig-name descname"><span class="pre">df_values_to_json</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">pandas.DataFrame</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">pandas.DataFrame</span><a class="reference internal" href="../../../../../_modules/datascience/src/pipeline/processing.html#df_values_to_json"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#datascience.src.pipeline.processing.df_values_to_json" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a <cite>pandas.DataFrame</cite> with all values serialized to json string.</p>
<p>This is required before bulk loading into a Postgresql table with
the psql_insert_copy method.</p>
<p>See <cite>to_json</cite> function for details.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>df</strong> (<em>pd.DataFrame</em>) – pandas DataFrame</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><dl class="simple">
<dt>pandas DataFrame with the same shape and index, all values</dt><dd><p>serialized as json strings.</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="datascience.src.pipeline.processing.drop_rows_already_in_table">
<span class="sig-prename descclassname"><span class="pre">datascience.src.pipeline.processing.</span></span><span class="sig-name descname"><span class="pre">drop_rows_already_in_table</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">pandas.DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">df_column_name</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">table</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">sqlalchemy.Table</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">table_column_name</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">connection</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">sqlalchemy.engine.base.Connection</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">logging.Logger</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">pandas.DataFrame</span><a class="reference internal" href="../../../../../_modules/datascience/src/pipeline/processing.html#drop_rows_already_in_table"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#datascience.src.pipeline.processing.drop_rows_already_in_table" title="Permalink to this definition">¶</a></dt>
<dd><p>Removes rows from the input DataFrame <cite>df</cite> in which the column <cite>df_column_name</cite>
contains values that are already present in the column <cite>table_column_name</cite> of the
table <cite>table</cite>, and returns the filtered DataFrame.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="datascience.src.pipeline.processing.prepare_df_for_loading">
<span class="sig-prename descclassname"><span class="pre">datascience.src.pipeline.processing.</span></span><span class="sig-name descname"><span class="pre">prepare_df_for_loading</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">pandas.DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logger</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">logging.Logger</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pg_array_columns</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">None</span><span class="p"><span class="pre">,</span> </span><span class="pre">list</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">handle_array_conversion_errors</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value_on_array_conversion_error</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'{}'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">jsonb_columns</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">None</span><span class="p"><span class="pre">,</span> </span><span class="pre">list</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../../../_modules/datascience/src/pipeline/processing.html#prepare_df_for_loading"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#datascience.src.pipeline.processing.prepare_df_for_loading" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="datascience.src.pipeline.processing.join_on_multiple_keys">
<span class="sig-prename descclassname"><span class="pre">datascience.src.pipeline.processing.</span></span><span class="sig-name descname"><span class="pre">join_on_multiple_keys</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">left</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">pandas.DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">right</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">pandas.DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">on</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">how</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">'inner'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../../../../_modules/datascience/src/pipeline/processing.html#join_on_multiple_keys"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#datascience.src.pipeline.processing.join_on_multiple_keys" title="Permalink to this definition">¶</a></dt>
<dd><p>Join two pandas DataFrames, attempting to match rows on several keys by
decreasing order of priority.</p>
<p>Joins are performed successively with each of the keys listed in <cite>on</cite>, and results
are then concatenated to form the final result. This is different from joining on a
composite key where all keys must match simultaneously : here, rows of left and
right DataFrames are joined if at least one of the keys match.</p>
<p>Joins are performed on the keys listed in <cite>on</cite> by “decreasing order or priority” in
the sense that rows of left and right that have been matched on one key are removed
from ulterior joins perfomed on the next keys.</p>
<p>During each of the joins on the individual keys, non-joining key pairs from left and
right DataFrames are coalesced.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>left</strong> (<em>pd.DataFrame</em>) – pandas DataFrame</p></li>
<li><p><strong>right</strong> (<em>pd.DataFrame</em>) – pandas DataFrame</p></li>
<li><p><strong>on</strong> (<em>list</em>) – list of column names to use as join keys</p></li>
<li><p><strong>how</strong> (<em>str</em>) – ‘inner’, ‘left’, ‘right’ or ‘outer’. Defaults to ‘inner’.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>result of join operation</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
</dl>
</dd></dl>

</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../schedules/index.html" class="btn btn-neutral float-right" title="datascience.src.pipeline.schedules" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="../generic_tasks/index.html" class="btn btn-neutral float-left" title="datascience.src.pipeline.generic_tasks" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Vincent Chéry.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>