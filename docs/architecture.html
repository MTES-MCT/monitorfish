

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Architecture &mdash; Monitorfish  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="External data sources" href="data-sources.html" />
    <link rel="prev" title="Control priority steering" href="control-priority-steering.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Monitorfish
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="feature-presentation.html">Feature presentation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Architecture</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#data-pipeline">Data pipeline</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#database-schema">Database schema</a></li>
<li class="toctree-l3"><a class="reference internal" href="#orchestration">Orchestration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#execution">Execution</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#stack">Stack</a></li>
<li class="toctree-l4"><a class="reference internal" href="#flows-one-for-each-job">Flows : one for each job</a></li>
<li class="toctree-l4"><a class="reference internal" href="#execution-in-a-dockerized-service">Execution in a dockerized service</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#back-end">Back end</a></li>
<li class="toctree-l2"><a class="reference internal" href="#front-end">Front end</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="data-sources.html">External data sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="flows.html">Flows</a></li>
<li class="toctree-l1"><a class="reference internal" href="containerization.html">Containerization</a></li>
<li class="toctree-l1"><a class="reference internal" href="deployment.html">Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">API reference</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Monitorfish</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Architecture</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/architecture.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="architecture">
<h1>Architecture<a class="headerlink" href="#architecture" title="Permalink to this headline">¶</a></h1>
<p>Monitorfish is built around 3 main components :</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#data-pipeline" id="id3">Data pipeline</a></p></li>
<li><p><a class="reference internal" href="#back-end" id="id4">Back end</a></p></li>
<li><p><a class="reference internal" href="#front-end" id="id5">Front end</a></p></li>
</ul>
</div>
<div class="section" id="data-pipeline">
<span id="id1"></span><h2><a class="toc-backref" href="#id3">Data pipeline</a><a class="headerlink" href="#data-pipeline" title="Permalink to this headline">¶</a></h2>
<p>The data processing service executes python batch jobs to :</p>
<ul class="simple">
<li><p>pull data from external sources into the Monitorfish database (ETL)</p></li>
<li><p>process data in the Monitorfish database to enrich and update tables that the backend makes available to the frontend through an API</p></li>
</ul>
<div class="section" id="database-schema">
<h3>Database schema<a class="headerlink" href="#database-schema" title="Permalink to this headline">¶</a></h3>
<p>Database tables are created by the <a class="reference internal" href="#back-end"><span class="std std-ref">Back end</span></a>. Jobs of the data pipeline require tables to already exist and to have the right
columns and data types. It is therefore necessary to keep the back end and the data pipeline applications “in sync”.
For this reason, the back end and the data pipeline should always be deployed with the <strong>same version number</strong> (see <a class="reference internal" href="deployment.html#environment-variables"><span class="std std-ref">Environment variables</span></a>).</p>
</div>
<div class="section" id="orchestration">
<h3>Orchestration<a class="headerlink" href="#orchestration" title="Permalink to this headline">¶</a></h3>
<p>Batch jobs are orchestrated by <a class="reference external" href="https://prefect.io">Prefect</a>. For more information see
<a class="reference external" href="https://docs.prefect.io/orchestration/">Prefect documentation</a>.</p>
<p>The prefect UI  enables administrators to view each flow as a diagram of its constituent tasks, to monitor their execution, see the logs and debug in case any flow run fails…</p>
</div>
<div class="section" id="execution">
<h3>Execution<a class="headerlink" href="#execution" title="Permalink to this headline">¶</a></h3>
<div class="section" id="stack">
<h4>Stack<a class="headerlink" href="#stack" title="Permalink to this headline">¶</a></h4>
<p>The main tools used to extract data, process it in python and load it to the PostgreSQL database of Monitorfish are :</p>
<ul class="simple">
<li><p>python 3.8.7</p></li>
<li><p><a class="reference external" href="https://www.sqlalchemy.org/">SQLAlchemy</a> as a python SQL toolkit to interact with SQL databases</p></li>
<li><p>Database adapters <a class="reference external" href="https://oracle.github.io/python-cx_Oracle/">cx_Oracle</a> and  <a class="reference external" href="https://github.com/psycopg/psycopg2/">psycopg2</a> for
connectivity to Oracle and PostgreSQL databases respectively</p></li>
<li><p><a class="reference external" href="https://pandas.pydata.org/">pandas</a> for data manipulation in python</p></li>
<li><p>the <a class="reference external" href="https://github.com/prefecthq/prefect">prefect python library</a> to write batch jobs as flows of tasks</p></li>
</ul>
</div>
<div class="section" id="flows-one-for-each-job">
<h4>Flows : one for each job<a class="headerlink" href="#flows-one-for-each-job" title="Permalink to this headline">¶</a></h4>
<p>Batch jobs are written in python as prefect <a class="reference internal" href="flows.html#flows"><span class="std std-ref">flows</span></a> : each flow is responsible
for one particular task, such as updating the <code class="docutils literal notranslate"><span class="pre">vessels</span></code> referencial or refreshing the table of <code class="docutils literal notranslate"><span class="pre">last_positions</span></code>.</p>
</div>
<div class="section" id="execution-in-a-dockerized-service">
<h4>Execution in a dockerized service<a class="headerlink" href="#execution-in-a-dockerized-service" title="Permalink to this headline">¶</a></h4>
<p>A dockerized python service runs a <a class="reference external" href="https://docs.prefect.io/orchestration/agents/overview.html">prefect agent</a>,
a small process which queries the API of the  prefect server orchestrator every second in order to know if any flow must be executed.
When a flow must be executed, perfect server tells the agent, which spawns a local python process that runs the flow.</p>
</div>
</div>
</div>
<div class="section" id="back-end">
<span id="id2"></span><h2><a class="toc-backref" href="#id4">Back end</a><a class="headerlink" href="#back-end" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Kotlin</p></li>
<li><p>Spring Boot</p></li>
<li><p>Flyway (database migration)</p></li>
<li><p>PostgreSQL with PostGIS/TimescaleDB</p></li>
<li><p>Tomcat (version 9.0.37)</p></li>
</ul>
</div>
<div class="section" id="front-end">
<h2><a class="toc-backref" href="#id5">Front end</a><a class="headerlink" href="#front-end" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Openlayers</p></li>
<li><p>React</p></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="data-sources.html" class="btn btn-neutral float-right" title="External data sources" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="control-priority-steering.html" class="btn btn-neutral float-left" title="Control priority steering" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Vincent Chéry.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>